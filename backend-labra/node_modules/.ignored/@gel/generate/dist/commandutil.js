#!/usr/bin/env node
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.isTTY = isTTY;
exports.promptBoolean = promptBoolean;
exports.promptForPassword = promptForPassword;
exports.readPasswordFromStdin = readPasswordFromStdin;
const node_process_1 = __importDefault(require("node:process"));
const gel_1 = require("gel");
const genutil_1 = require("./genutil");
const { input } = gel_1.systemUtils;
function isTTY() {
    return node_process_1.default.stdin.isTTY && node_process_1.default.stdout.isTTY;
}
async function promptBoolean(prompt, defaultVal) {
    const response = await promptEnum(prompt, ["y", "n"], defaultVal !== undefined ? (defaultVal ? "y" : "n") : undefined);
    return response === "y";
}
async function promptEnum(question, vals, defaultVal) {
    let response = await input(`${question}[${vals.join("/")}]${defaultVal !== undefined ? ` (leave blank for "${defaultVal}")` : ""}\n> `);
    response = response.trim().toLowerCase();
    if (vals.includes(response)) {
        return response;
    }
    else if (!response && defaultVal !== undefined) {
        return defaultVal;
    }
    else {
        (0, genutil_1.exitWithError)(`Unknown value: '${response}'`);
    }
}
async function promptForPassword(username) {
    if (!isTTY()) {
        (0, genutil_1.exitWithError)(`Cannot use --password option in non-interactive mode. ` +
            `To read password from stdin use the --password-from-stdin option.`);
    }
    return await input(`Password for '${username}': `, { silent: true });
}
function readPasswordFromStdin() {
    if (node_process_1.default.stdin.isTTY) {
        (0, genutil_1.exitWithError)(`Cannot read password from stdin: stdin is a TTY.`);
    }
    return new Promise((resolve) => {
        let data = "";
        node_process_1.default.stdin.on("data", (chunk) => (data += chunk));
        node_process_1.default.stdin.on("end", () => resolve(data.trimEnd()));
    });
}
